{"version":3,"sources":["../../../src/gamecanvas/types/MotionEventManager.js"],"names":["MotionEventManager","onEnterFrame","_enqueueIdx","_currentQueue","_eventQueue","length","last","acceleration","x","y","z","_last","onLeaveFrame","supported","_supported","rejected","_rejected","accelerationEventCount","accelerationLastX","accelerationLastY","accelerationLastZ","getAcceleration","index","includeGravity","accelerationIncludingGravity","constructor","Array","undefined","window","DeviceMotionEvent","requestPermission","confirm","then","res","addEventListener","e","push","console","log","trace"],"mappings":"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","sourcesContent":["\r\nexport default class MotionEventManager {\r\n    _eventQueue = [new Array(), new Array()];\r\n    _enqueueIdx = 0;\r\n    _currentQueue = undefined;\r\n    _supported = false;\r\n    _rejected = false;\r\n    _last = { x: 0, y: 0, z: 0 };\r\n\r\n    onEnterFrame() {\r\n        this._enqueueIdx = 1 - this._enqueueIdx; // swap\r\n        this._currentQueue = this._eventQueue[1 - this._enqueueIdx];\r\n        if (this._currentQueue.length > 0) {\r\n            const last = this._currentQueue[this._currentQueue.length - 1].acceleration;\r\n            if (typeof last.x === \"number\" && typeof last.y === \"number\" && typeof last.z === \"number\") {\r\n                this._last = last;\r\n            }\r\n        }\r\n    }\r\n    onLeaveFrame() {\r\n        this._currentQueue.length = 0;\r\n    }\r\n\r\n    get supported() { return this._supported; }\r\n    get rejected() { return this._rejected; }\r\n    get accelerationEventCount() { return this._currentQueue.length; }\r\n    get accelerationLastX() { return this._last.x; }\r\n    get accelerationLastY() { return this._last.y; }\r\n    get accelerationLastZ() { return this._last.z; }\r\n\r\n    getAcceleration(index, includeGravity = false) {\r\n        if (this._currentQueue.length >= index) return null;\r\n        if (includeGravity) {\r\n            return this._currentQueue[index].accelerationIncludingGravity;\r\n        }\r\n        return this._currentQueue[index].acceleration;\r\n    }\r\n\r\n    constructor() {\r\n        if (window.DeviceMotionEvent) {\r\n            this._supported = true;\r\n\r\n            if (typeof DeviceMotionEvent.requestPermission === \"function\") {\r\n                this._rejected = true;\r\n                if (window.confirm(\"GameCanvas requires access to your sensors. Press continue to allow.\")) {\r\n                    DeviceMotionEvent.requestPermission().then(res => {\r\n                        if (res === \"granted\") {\r\n                            this._rejected = false;\r\n                            window.addEventListener(\"devicemotion\", e => { this._eventQueue[this._enqueueIdx].push(e); }, false);\r\n                        }\r\n                    });\r\n                }\r\n            } else {\r\n                window.addEventListener(\"devicemotion\", e => { this._eventQueue[this._enqueueIdx].push(e); }, false);\r\n            }\r\n        } else {\r\n            this._supported = false;\r\n            console.log(\"devicemotion is not supported.\");\r\n        }\r\n    }\r\n\r\n    trace() {\r\n        if (this._supported) {\r\n            if (this._rejected) {\r\n                return \"Acce: denied\";\r\n            }\r\n            const x = (~~(this._last.x * 100)) * 0.01;\r\n            const y = (~~(this._last.y * 100)) * 0.01;\r\n            const z = (~~(this._last.z * 100)) * 0.01;\r\n            return `Acce: ${x}, ${y}, ${z}`\r\n        }\r\n        return \"Acce: not supported\";\r\n    }\r\n}\r\n"],"file":"MotionEventManager.js"}