{"version":3,"sources":["../../../src/gamecanvas/types/GameBase.js"],"names":["GameBase","initGame","enterGame","updateGame","resizeGame","drawGame","leaveGame","finalGame","_log","str","console","log","_update","timestamp","window","requestAnimationFrame","__update","_isFocused","deltaTime","_prevTimestamp","_gc","_onEnterFrame","updateBefore","performance","now","drawBefore","updateTime","drawTime","_drawProfiler","_onLeaveFrame","_onLoad","document","visibilityState","addEventListener","isFocused","_onResizeWindow","bind","constructor","gc","undefined"],"mappings":"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","sourcesContent":["\r\nexport default class GameBase {\r\n    _isFocused = false;\r\n    _prevTimestamp = 0;\r\n    _gc = undefined;\r\n    __update = undefined;\r\n\r\n    initGame() { }\r\n    enterGame() { }\r\n    updateGame() { }\r\n    resizeGame() { }\r\n    drawGame() { }\r\n    leaveGame() { }\r\n    finalGame() { }\r\n\r\n    _log(str) {\r\n        console.log(str);\r\n    }\r\n\r\n    _update(timestamp) {\r\n        window.requestAnimationFrame(this.__update);\r\n        if (this._isFocused) {\r\n            const deltaTime = timestamp - this._prevTimestamp;\r\n            this._gc._onEnterFrame(deltaTime);\r\n            const updateBefore = window.performance.now();\r\n            this.updateGame();\r\n            const drawBefore = window.performance.now();\r\n            this.drawGame();\r\n            const updateTime = drawBefore - updateBefore;\r\n            const drawTime = window.performance.now() - drawBefore;\r\n            this._gc._drawProfiler(updateTime, drawTime);\r\n            this._gc._onLeaveFrame();\r\n            this._prevTimestamp = timestamp;\r\n        }\r\n    }\r\n\r\n    _onLoad() {\r\n        this._log(\"onInit\");\r\n        this._gc._onLoad();\r\n        this.initGame();\r\n\r\n        if (document.visibilityState !== \"hidden\") {\r\n            this._isFocused = true;\r\n            this.enterGame();\r\n        }\r\n\r\n        window.addEventListener(\"visibilitychange\", () => {\r\n            const isFocused = (document.visibilityState !== \"hidden\");\r\n            this._log(`onVisibilitychange ${isFocused}`);\r\n            if (isFocused && !this._isFocused) this.enterGame();\r\n            if (!isFocused && this._isFocused) this.leaveGame();\r\n            this._isFocused = isFocused;\r\n        }, false);\r\n        window.addEventListener(\"resize\", () => {\r\n            this._log(\"onResizeWindow\");\r\n            this._gc._onResizeWindow();\r\n        }, false);\r\n        window.addEventListener(\"close\", () => {\r\n            this._log(\"onClose\");\r\n            this.finalGame();\r\n        }, false);\r\n        this.__update = this._update.bind(this);\r\n        window.requestAnimationFrame(this.__update);\r\n    }\r\n\r\n    constructor(gc) {\r\n        this._gc = gc;\r\n        document.addEventListener(\"DOMContentLoaded\", () => { this._onLoad(); }, false);\r\n    }\r\n}\r\n"],"file":"GameBase.js"}