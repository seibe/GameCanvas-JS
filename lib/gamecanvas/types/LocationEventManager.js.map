{"version":3,"sources":["../../../src/gamecanvas/types/LocationEventManager.js"],"names":["LocationEventManager","onEnterFrame","frameCount","_frameCount","onLeaveFrame","supported","_supported","status","_status","hasNewValue","_lastUpdateFrame","lastLatitude","_last","coords","latitude","lastLongitude","longitude","lastAltitude","altitude","lastTime","timestamp","lastFrame","getCurrent","enableHighAccuracy","timeout","Promise","success","failure","navigator","geolocation","getCurrentPosition","pos","err","endWatching","_watchId","clearWatch","undefined","startWatching","watchPosition","console","error","constructor","trace"],"mappings":"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","sourcesContent":["\r\nexport default class LocationEventManager {\r\n    _supported = false;\r\n    _frameCount = 0;\r\n    _last = undefined;\r\n    _lastUpdateFrame = -1;\r\n    _watchId = undefined;\r\n    _status = undefined;\r\n\r\n    onEnterFrame(frameCount) {\r\n        this._frameCount = frameCount;\r\n    }\r\n    onLeaveFrame() {\r\n        this._frameCount++;\r\n    }\r\n\r\n    get supported() { return this._supported; }\r\n    get status() { return this._status; }\r\n    get hasNewValue() { return (this._lastUpdateFrame === this._frameCount); }\r\n    get lastLatitude() { return this._last ? this._last.coords.latitude : null; }\r\n    get lastLongitude() { return this._last ? this._last.coords.longitude : null; }\r\n    get lastAltitude() { return this._last ? this._last.coords.altitude : null; }\r\n    get lastTime() { return this._last ? this._last.timestamp : -1; }\r\n    get lastFrame() { return this._lastUpdateFrame; }\r\n\r\n    async getCurrent(enableHighAccuracy = false, timeout = 0) {\r\n        return new Promise((success, failure) => {\r\n            navigator.geolocation.getCurrentPosition(pos => {\r\n                this._last = pos;\r\n                this._lastUpdateFrame = this._frameCount;\r\n                success(pos);\r\n            }, err => {\r\n                failure(err);\r\n            }, { enableHighAccuracy, timeout });\r\n        });\r\n    }\r\n\r\n    endWatching() {\r\n        if (this._watchId) {\r\n            navigator.geolocation.clearWatch(this._watchId);\r\n            this._watchId = undefined;\r\n            this._status = \"stopped\";\r\n        }\r\n    }\r\n\r\n    startWatching(enableHighAccuracy = false) {\r\n        this._watchId = navigator.geolocation.watchPosition(pos => {\r\n            this._last = pos;\r\n            this._lastUpdateFrame = this._frameCount;\r\n            this._status = \"running\";\r\n        }, err => {\r\n            console.error(err);\r\n            this._status = \"failed\";\r\n        }, { enableHighAccuracy });\r\n        this._status = \"running\";\r\n    }\r\n\r\n    constructor() {\r\n        this._supported = (\"geolocation\" in navigator);\r\n        this._status = \"stopped\";\r\n    }\r\n\r\n    trace() {\r\n        if (this._supported) {\r\n            if (this._last) {\r\n                return `Geo: ${this._last.coords.latitude}, ${this._last.coords.longitude} (${this._status})`;\r\n            }\r\n            return `Geo: none (${this._status})`;\r\n        }\r\n        return \"Geo: not supported\";\r\n    }\r\n}\r\n"],"file":"LocationEventManager.js"}