{"version":3,"sources":["../../../src/gamecanvas/types/GameCanvasBase.js"],"names":["Random","PointerEventManager","KeyEventManager","MotionEventManager","FrameProfile","LocationEventManager","GameCanvasBase","constructor","_rand","_pointer","undefined","_key","_motion","_location","_width","_height","_scale","_color","r","g","b","_lineWidth","_fontSize","_fontFamily","_frameCount","_beginTime","_deltaTime","_elapsedTime","_body","_title","_deg2rad","Math","PI","_rad2deg","_storageEnabled","_profilerEnabled","_imageMap","Map","_soundMap","_styleStack","Array","_profileList","storage","window","x","setItem","removeItem","e","DOMException","code","name","length","KEY_UP","KEY_DOWN","KEY_LEFT","KEY_RIGHT","KEY_Z","KEY_X","KEY_C","KEY_V","KEY_ENTER","KEY_SPACE","COLOR_WHITE","COLOR_BLACK","COLOR_GRAY","COLOR_RED","COLOR_BLUE","COLOR_GREEN","COLOR_YELLOW","COLOR_PURPLE","COLOR_CYAN","COLOR_AQUA","width","height","beginTime","deltaTime","elapsedTime","frameCount","profilerEnabled","value","_onResizeWindow","setColor","setLineWidth","setFont","fontName","fontStyle","fontSize","setWindowTitle","title","innerText","setSeed","seed","rand","min","max","nextInt","resetGame","exitApp","showYesNoDialog","message","showInputDialog","defaultInput","playBGM","changeBGMVolume","stopBGM","pauseBGM","playSE","changeSEVolume","stopSE","pauseSE","getKeyPressLength","keyCode","isKeyPress","isKeyPushed","isKeyReleased","getMouseX","mouseX","getMouseY","mouseY","getMouseClickLength","isMousePushed","isMouseReleased","isMousePress","load","key","localStorage","getItem","save","checkHitRect","x1","y1","w1","h1","x2","y2","w2","h2","checkHitImage","filename1","filename2","checkHitCircle","r1","r2","checkHitPointer","y","w","h","checkHitPointerDown","checkHitPointerUp","sqrt","cos","degree","sin","atan2","pushStyle","push","color","lineWidth","fontFamily","popStyle","style","pop","geolocationSupported","supported","geolocationStatus","status","geolocationLastLatitude","lastLatitude","geolocationLastLongitude","lastLongitude","geolocationLastAltitude","lastAltitude","geolocationLastTime","lastTime","geolocationLastFrame","lastFrame","startGeolocationService","enableHighAccuracy","timeout","startWatching","stopGeolocationService","endWatching","_fetchUntilSuccessOrAllFailed","urlArray","reqArray","map","url","fetch","resArray","Promise","all","res","ok","Error","_preloadResourceImage","i","req","img","Image","src","URL","createObjectURL","blob","set","_preloadResourceSound","snd","Audio","_preloadResource","_onLoad","surface","document","body","getElementsByTagName","item","performance","now","_onEnterFrame","onEnterFrame","_onLeaveFrame","onLeaveFrame","_drawProfiler","updateTime","drawTime"],"mappings":"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","sourcesContent":["\r\nimport Random from \"./Random.js\";\r\nimport PointerEventManager from \"./PointerEventManager.js\";\r\nimport KeyEventManager from \"./KeyEventManager.js\";\r\nimport MotionEventManager from \"./MotionEventManager.js\";\r\nimport FrameProfile from \"./FrameProfile.js\";\r\nimport LocationEventManager from \"./LocationEventManager.js\";\r\n\r\nexport default class GameCanvasBase {\r\n    _rand = new Random(6);\r\n    _pointer = undefined;\r\n    _key = undefined;\r\n    _motion = undefined;\r\n    _location = undefined;\r\n    _width = 640;\r\n    _height = 480;\r\n    _scale = 1;\r\n    _color = { r: 0, g: 0, b: 0 };\r\n    _lineWidth = 1;\r\n    _fontSize = 25;\r\n    _fontFamily = \"Arial\";\r\n    _frameCount = 0;\r\n    _beginTime = 0;\r\n    _deltaTime = 0;\r\n    _elapsedTime = 0;\r\n    _body = undefined;\r\n    _title = undefined;\r\n    _deg2rad = Math.PI / 180;\r\n    _rad2deg = 180 / Math.PI;\r\n    _storageEnabled = undefined;\r\n    _profilerEnabled = false;\r\n    _imageMap = new Map();\r\n    _soundMap = new Map();\r\n    _styleStack = new Array();\r\n    _profileList = new Array();\r\n\r\n    constructor() {\r\n        try {\r\n            const storage = window[\"localStorage\"];\r\n            const x = \"__storage_test__\";\r\n            storage.setItem(x, x);\r\n            storage.removeItem(x);\r\n            this._storageEnabled = true;\r\n        }\r\n        catch (e) {\r\n            this._storageEnabled = (e instanceof DOMException)\r\n                && (e.code === 22 || e.code === 1014 || e.name === 'QuotaExceededError' || e.name === 'NS_ERROR_DOM_QUOTA_REACHED')\r\n                && (storage.length !== 0);\r\n        }\r\n    }\r\n\r\n    get KEY_UP() {\r\n        return \"ArrowUp\";\r\n    }\r\n    get KEY_DOWN() {\r\n        return \"ArrowDown\";\r\n    }\r\n    get KEY_LEFT() {\r\n        return \"ArrowLeft\";\r\n    }\r\n    get KEY_RIGHT() {\r\n        return \"ArrowRight\";\r\n    }\r\n    get KEY_Z() {\r\n        return \"KeyZ\";\r\n    }\r\n    get KEY_X() {\r\n        return \"KeyX\";\r\n    }\r\n    get KEY_C() {\r\n        return \"KeyC\";\r\n    }\r\n    get KEY_V() {\r\n        return \"KeyV\";\r\n    }\r\n    get KEY_ENTER() {\r\n        return \"Enter\";\r\n    }\r\n    get KEY_SPACE() {\r\n        return \"Space\";\r\n    }\r\n\r\n    get COLOR_WHITE() {\r\n        return 0xFFFFFF;\r\n    }\r\n    get COLOR_BLACK() {\r\n        return 0x000000;\r\n    }\r\n    get COLOR_GRAY() {\r\n        return 0x808080;\r\n    }\r\n    get COLOR_RED() {\r\n        return 0xFF0000;\r\n    }\r\n    get COLOR_BLUE() {\r\n        return 0x0000FF;\r\n    }\r\n    get COLOR_GREEN() {\r\n        return 0x00FF00;\r\n    }\r\n    get COLOR_YELLOW() {\r\n        return 0xFFFF00;\r\n    }\r\n    get COLOR_PURPLE() {\r\n        return 0xFF00FF;\r\n    }\r\n    get COLOR_CYAN() {\r\n        return 0x00FFFF;\r\n    }\r\n    get COLOR_AQUA() {\r\n        return 0x7F7FFF;\r\n    }\r\n\r\n    get width() {\r\n        return this._width;\r\n    }\r\n    get height() {\r\n        return this._height;\r\n    }\r\n    get beginTime() {\r\n        return this._beginTime;\r\n    }\r\n    get deltaTime() {\r\n        return this._deltaTime;\r\n    }\r\n    get elapsedTime() {\r\n        return this._elapsedTime;\r\n    }\r\n    get frameCount() {\r\n        return this._frameCount;\r\n    }\r\n    get profilerEnabled() {\r\n        return this._profilerEnabled;\r\n    }\r\n\r\n    set profilerEnabled(value) {\r\n        if (this._profilerEnabled !== value) {\r\n            this._profilerEnabled = value;\r\n            this._onResizeWindow();\r\n        }\r\n    }\r\n\r\n    setColor(r, g, b) {\r\n        this._color.r = r;\r\n        this._color.g = g;\r\n        this._color.b = b;\r\n    }\r\n    setLineWidth(width) {\r\n        this._lineWidth = width;\r\n    }\r\n    setFont(fontName, fontStyle, fontSize) {\r\n        this._fontFamily = fontName;\r\n        this._fontSize = fontSize;\r\n    }\r\n    setWindowTitle(title) {\r\n        if (this._title) this._title.innerText = title;\r\n    }\r\n    setSeed(seed) {\r\n        this._rand = new Random(seed);\r\n    }\r\n    rand(min, max) {\r\n        return this._rand.nextInt(max, min);\r\n    }\r\n    resetGame() {\r\n        // todo\r\n    }\r\n    exitApp() {\r\n        // todo\r\n    }\r\n\r\n    showYesNoDialog(message) {\r\n        // todo\r\n    }\r\n    showInputDialog(message, defaultInput) {\r\n        // todo\r\n    }\r\n\r\n    playBGM() { }\r\n    changeBGMVolume() { }\r\n    stopBGM() { }\r\n    pauseBGM() { }\r\n    playSE() { }\r\n    changeSEVolume() { }\r\n    stopSE() { }\r\n    pauseSE() { }\r\n\r\n    getKeyPressLength(keyCode) {\r\n        return this._key.getKeyPressLength(keyCode);\r\n    }\r\n    isKeyPress(keyCode) {\r\n        return this._key.isKeyPress(keyCode);\r\n    }\r\n    isKeyPushed(keyCode) {\r\n        return this._key.isKeyPushed(keyCode);\r\n    }\r\n    isKeyReleased(keyCode) {\r\n        return this._key.isKeyReleased(keyCode);\r\n    }\r\n\r\n    getMouseX() {\r\n        return this._pointer.mouseX;\r\n    }\r\n    getMouseY() {\r\n        return this._pointer.mouseY;\r\n    }\r\n    getMouseClickLength() {\r\n        return this._pointer.getMouseClickLength;\r\n    }\r\n    isMousePushed() {\r\n        return this._pointer.isMousePushed;\r\n    }\r\n    isMouseReleased() {\r\n        return this._pointer.isMouseReleased;\r\n    }\r\n    isMousePress() {\r\n        return this._pointer.isMousePress;\r\n    }\r\n\r\n    load(key) {\r\n        if (this._storageEnabled && key) {\r\n            return window.localStorage.getItem(`gamecanvas-${key}`);\r\n        }\r\n        return undefined;\r\n    }\r\n    save(key, value) {\r\n        if (this._storageEnabled && key) {\r\n            if (value) {\r\n                window.localStorage.setItem(`gamecanvas-${key}`, value);\r\n            } else {\r\n                window.localStorage.removeItem(`gamecanvas-${key}`);\r\n            }\r\n        }\r\n    }\r\n\r\n    checkHitRect(x1, y1, w1, h1, x2, y2, w2, h2) {\r\n        // todo\r\n    }\r\n    checkHitImage(filename1, x1, y1, filename2, x2, y2) {\r\n        // todo\r\n    }\r\n    checkHitCircle(x1, y1, r1, x2, y2, r2) {\r\n        // todo\r\n    }\r\n    checkHitPointer(x, y, w, h) {\r\n        return this._pointer.checkHitRect(x, y, w, h);\r\n    }\r\n    checkHitPointerDown(x, y, w, h) {\r\n        return this._pointer.checkHitRect(x, y, w, h, \"pointerdown\");\r\n    }\r\n    checkHitPointerUp(x, y, w, h) {\r\n        return this._pointer.checkHitRect(x, y, w, h, \"pointerup\");\r\n    }\r\n    sqrt(value) {\r\n        return Math.sqrt(value);\r\n    }\r\n    cos(degree) {\r\n        return Math.cos(degree * this._deg2rad) * this._rad2deg;\r\n    }\r\n    sin(degree) {\r\n        return Math.sin(degree * this._deg2rad) * this._rad2deg;\r\n    }\r\n    atan2(x, y) {\r\n        return Math.atan2(y, x) * this._rad2deg;\r\n    }\r\n\r\n    pushStyle() {\r\n        this._styleStack.push({\r\n            color: this._color,\r\n            lineWidth: this._lineWidth,\r\n            fontFamily: this._fontFamily,\r\n            fontSize: this._fontSize\r\n        });\r\n    }\r\n    popStyle() {\r\n        if (this._styleStack.length === 0) return;\r\n        const style = this._styleStack.pop();\r\n        this.setColor(style.color.r, style.color.g, style.color.b);\r\n        this.setLineWidth(style.lineWidth);\r\n        this.setFont(style.fontFamily, null, style.fontSize);\r\n    }\r\n\r\n    get geolocationSupported() { return this._location.supported; }\r\n    get geolocationStatus() { return this._location.status; }\r\n    get geolocationLastLatitude() { return this._location.lastLatitude; }\r\n    get geolocationLastLongitude() { return this._location.lastLongitude; }\r\n    get geolocationLastAltitude() { return this._location.lastAltitude; }\r\n    get geolocationLastTime() { return this._location.lastTime; }\r\n    get geolocationLastFrame() { return this._location.lastFrame; }\r\n    startGeolocationService(enableHighAccuracy = false, timeout = 0) {\r\n        this._location.startWatching(enableHighAccuracy, timeout);\r\n    }\r\n    stopGeolocationService() {\r\n        this._location.endWatching();\r\n    }\r\n\r\n    async _fetchUntilSuccessOrAllFailed(urlArray) {\r\n        if (urlArray && urlArray.length !== 0) {\r\n            try {\r\n                const reqArray = urlArray.map(url => fetch(url));\r\n                const resArray = await Promise.all(reqArray);\r\n                for (const res of resArray) {\r\n                    if (res.ok) return res;\r\n                }\r\n            } catch (e) {\r\n                throw e;\r\n            }\r\n            throw new Error(\"all fetch are failed\");\r\n        }\r\n        throw new Error(\"parameter error\");\r\n    }\r\n    async _preloadResourceImage() {\r\n        for (let i = 0; ; i++) {\r\n            try {\r\n                const req = await this._fetchUntilSuccessOrAllFailed([\r\n                    `./res/img${i}.gif`,\r\n                    `./res/img${i}.png`,\r\n                    `./res/img${i}.jpg`,\r\n                    `./res/img${i}.webp`\r\n                ]);\r\n                const img = new Image();\r\n                img.src = URL.createObjectURL(await req.blob());\r\n                this._imageMap.set(i, img);\r\n            }\r\n            catch (e) {\r\n                break;\r\n            }\r\n        }\r\n    }\r\n    async _preloadResourceSound() {\r\n        for (let i = 0; ; i++) {\r\n            try {\r\n                const req = await this._fetchUntilSuccessOrAllFailed([\r\n                    `./res/snd${i}.wav`,\r\n                    `./res/snd${i}.mp3`,\r\n                    `./res/snd${i}.ogg`,\r\n                    `./res/snd${i}.aac`,\r\n                    `./res/snd${i}.flac`\r\n                ]);\r\n                const snd = new Audio();\r\n                snd.src = URL.createObjectURL(await req.blob());\r\n                this._soundMap.set(i, snd);\r\n            }\r\n            catch (e) {\r\n                break;\r\n            }\r\n        }\r\n    }\r\n    async _preloadResource() {\r\n        await Promise.all([this._preloadResourceImage(), this._preloadResourceSound()]);\r\n        //console.clear();\r\n    }\r\n\r\n    _onLoad(surface) {\r\n        this._body = document.body;\r\n        this._title = document.getElementsByTagName(\"title\").item(0);\r\n        this._beginTime = window.performance.now();\r\n        this._pointer = new PointerEventManager(surface);\r\n        this._key = new KeyEventManager();\r\n        this._motion = new MotionEventManager();\r\n        this._location = new LocationEventManager();\r\n        this._onResizeWindow();\r\n        this._preloadResource();\r\n        this.setColor(0, 0, 0);\r\n        this.setLineWidth(1);\r\n        this.setFont(\"Arial\", null, 25);\r\n    }\r\n    _onEnterFrame(deltaTime) {\r\n        this._frameCount++;\r\n        this._deltaTime = deltaTime;\r\n        this._elapsedTime = window.performance.now() - this._beginTime;\r\n        this._pointer.onEnterFrame(this._frameCount, this._elapsedTime);\r\n        this._key.onEnterFrame(this._frameCount, this._elapsedTime);\r\n        this._motion.onEnterFrame();\r\n        this._location.onEnterFrame(this._frameCount);\r\n    }\r\n    _onLeaveFrame() {\r\n        this._pointer.onLeaveFrame();\r\n        this._key.onLeaveFrame();\r\n        this._motion.onLeaveFrame();\r\n        this._location.onLeaveFrame();\r\n    }\r\n    _onResizeWindow() { }\r\n    _drawProfiler(updateTime, drawTime) {\r\n        this._profileList.push(new FrameProfile(this._frameCount, this._deltaTime, updateTime, drawTime));\r\n    }\r\n}\r\n"],"file":"GameCanvasBase.js"}